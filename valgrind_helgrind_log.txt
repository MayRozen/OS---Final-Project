==6703== Helgrind, a thread error detector
==6703== Copyright (C) 2007-2017, and GNU GPL'd, by OpenWorks LLP et al.
==6703== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==6703== Command: ./server
==6703== Parent PID: 6702
==6703== 
==6703== ---Thread-Announcement------------------------------------------
==6703== 
==6703== Thread #1 is the program's root thread
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #1: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48513D6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D8DA: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:40)
==6703==    by 0x110A5C: main (Server.cpp:255)
==6703== 
==6703== ---Thread-Announcement------------------------------------------
==6703== 
==6703== Thread #2 was created
==6703==    at 0x4BE79F3: clone (clone.S:76)
==6703==    by 0x4BE88EE: __clone_internal (clone-internal.c:83)
==6703==    by 0x4B566D8: create_thread (pthread_create.c:295)
==6703==    by 0x4B571FF: pthread_create@@GLIBC_2.34 (pthread_create.c:828)
==6703==    by 0x4853767: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4952328: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x12742D: std::thread::thread<void (LeaderFollower::*)(), LeaderFollower*, void>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (std_thread.h:143)
==6703==    by 0x125F3A: void __gnu_cxx::new_allocator<std::thread>::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (new_allocator.h:162)
==6703==    by 0x12417B: void std::allocator_traits<std::allocator<std::thread> >::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::allocator<std::thread>&, std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (alloc_traits.h:516)
==6703==    by 0x124269: void std::vector<std::thread, std::allocator<std::thread> >::_M_realloc_insert<void (LeaderFollower::*)(), LeaderFollower*>(__gnu_cxx::__normal_iterator<std::thread*, std::vector<std::thread, std::allocator<std::thread> > >, void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:449)
==6703==    by 0x122891: std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (LeaderFollower::*)(), LeaderFollower*>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:121)
==6703==    by 0x11D61B: LeaderFollower::LeaderFollower(unsigned long) (Tree.cpp:7)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48513D6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D8DA: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:40)
==6703==    by 0x11E245: Tree::calculateTotalWeight() const (Tree.cpp:113)
==6703==    by 0x10FEDF: handleRequest(int) (Server.cpp:147)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ---Thread-Announcement------------------------------------------
==6703== 
==6703== Thread #6 was created
==6703==    at 0x4BE79F3: clone (clone.S:76)
==6703==    by 0x4BE88EE: __clone_internal (clone-internal.c:83)
==6703==    by 0x4B566D8: create_thread (pthread_create.c:295)
==6703==    by 0x4B571FF: pthread_create@@GLIBC_2.34 (pthread_create.c:828)
==6703==    by 0x4853767: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4952328: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x12742D: std::thread::thread<void (LeaderFollower::*)(), LeaderFollower*, void>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (std_thread.h:143)
==6703==    by 0x125F3A: void __gnu_cxx::new_allocator<std::thread>::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (new_allocator.h:162)
==6703==    by 0x12417B: void std::allocator_traits<std::allocator<std::thread> >::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::allocator<std::thread>&, std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (alloc_traits.h:516)
==6703==    by 0x124269: void std::vector<std::thread, std::allocator<std::thread> >::_M_realloc_insert<void (LeaderFollower::*)(), LeaderFollower*>(__gnu_cxx::__normal_iterator<std::thread*, std::vector<std::thread, std::allocator<std::thread> > >, void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:449)
==6703==    by 0x122891: std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (LeaderFollower::*)(), LeaderFollower*>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:121)
==6703==    by 0x11D61B: LeaderFollower::LeaderFollower(unsigned long) (Tree.cpp:7)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during read of size 8 at 0x4DEB170 by thread #2
==6703== Locks held: none
==6703==    at 0x1259B0: std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::release() (unique_ptr.h:187)
==6703==    by 0x123D3D: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::release() (unique_ptr.h:443)
==6703==    by 0x12253D: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, void>(std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:341)
==6703==    by 0x12C753: std::packaged_task<void ()>::~packaged_task() (future:1569)
==6703==    by 0x12C2E9: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::destroy<std::packaged_task<void ()> >(std::packaged_task<void ()>*) (new_allocator.h:168)
==6703==    by 0x12BFBE: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::destroy<std::packaged_task<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*) (alloc_traits.h:535)
==6703==    by 0x12BBF8: std::_Sp_counted_ptr_inplace<std::packaged_task<void ()>, std::allocator<std::packaged_task<void ()> >, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:528)
==6703==    by 0x11430E: std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (shared_ptr_base.h:168)
==6703==    by 0x113ACA: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (shared_ptr_base.h:705)
==6703==    by 0x12186F: std::__shared_ptr<std::packaged_task<void ()>, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (shared_ptr_base.h:1154)
==6703==    by 0x12188F: std::shared_ptr<std::packaged_task<void ()> >::~shared_ptr() (shared_ptr.h:122)
==6703==    by 0x11D8E7: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:43)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #6
==6703== Locks held: none
==6703==    at 0x122486: std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::__uniq_ptr_impl(std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:163)
==6703==    by 0x121728: std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>::__uniq_ptr_data(std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>&&) (unique_ptr.h:211)
==6703==    by 0x121752: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::unique_ptr(std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:327)
==6703==    by 0x12CB3A: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1419)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703==    by 0x12C3FF: std::enable_if<is_invocable_r_v<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>, std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> >::type std::__invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:116)
==6703==    by 0x12C0EA: std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void> >::_M_invoke(std::_Any_data const&) (std_function.h:291)
==6703==    by 0x122071: std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const (std_function.h:590)
==6703==  Address 0x4deb170 is 48 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during write of size 8 at 0x4DEB170 by thread #2
==6703== Locks held: none
==6703==    at 0x1259C3: std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::release() (unique_ptr.h:188)
==6703==    by 0x123D3D: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::release() (unique_ptr.h:443)
==6703==    by 0x12253D: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, void>(std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:341)
==6703==    by 0x12C753: std::packaged_task<void ()>::~packaged_task() (future:1569)
==6703==    by 0x12C2E9: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::destroy<std::packaged_task<void ()> >(std::packaged_task<void ()>*) (new_allocator.h:168)
==6703==    by 0x12BFBE: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::destroy<std::packaged_task<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*) (alloc_traits.h:535)
==6703==    by 0x12BBF8: std::_Sp_counted_ptr_inplace<std::packaged_task<void ()>, std::allocator<std::packaged_task<void ()> >, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:528)
==6703==    by 0x11430E: std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (shared_ptr_base.h:168)
==6703==    by 0x113ACA: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (shared_ptr_base.h:705)
==6703==    by 0x12186F: std::__shared_ptr<std::packaged_task<void ()>, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (shared_ptr_base.h:1154)
==6703==    by 0x12188F: std::shared_ptr<std::packaged_task<void ()> >::~shared_ptr() (shared_ptr.h:122)
==6703==    by 0x11D8E7: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:43)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #6
==6703== Locks held: none
==6703==    at 0x122486: std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::__uniq_ptr_impl(std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:163)
==6703==    by 0x121728: std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>::__uniq_ptr_data(std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>&&) (unique_ptr.h:211)
==6703==    by 0x121752: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::unique_ptr(std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:327)
==6703==    by 0x12CB3A: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1419)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703==    by 0x12C3FF: std::enable_if<is_invocable_r_v<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>, std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> >::type std::__invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:116)
==6703==    by 0x12C0EA: std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void> >::_M_invoke(std::_Any_data const&) (std_function.h:291)
==6703==    by 0x122071: std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const (std_function.h:590)
==6703==  Address 0x4deb170 is 48 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ---Thread-Announcement------------------------------------------
==6703== 
==6703== Thread #9 was created
==6703==    at 0x4BE79F3: clone (clone.S:76)
==6703==    by 0x4BE88EE: __clone_internal (clone-internal.c:83)
==6703==    by 0x4B566D8: create_thread (pthread_create.c:295)
==6703==    by 0x4B571FF: pthread_create@@GLIBC_2.34 (pthread_create.c:828)
==6703==    by 0x4853767: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4952328: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x12742D: std::thread::thread<void (LeaderFollower::*)(), LeaderFollower*, void>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (std_thread.h:143)
==6703==    by 0x125F3A: void __gnu_cxx::new_allocator<std::thread>::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (new_allocator.h:162)
==6703==    by 0x12417B: void std::allocator_traits<std::allocator<std::thread> >::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::allocator<std::thread>&, std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (alloc_traits.h:516)
==6703==    by 0x12283C: std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (LeaderFollower::*)(), LeaderFollower*>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:115)
==6703==    by 0x11D61B: LeaderFollower::LeaderFollower(unsigned long) (Tree.cpp:7)
==6703==    by 0x11E13B: Tree::calculateTotalWeight() const (Tree.cpp:106)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during read of size 8 at 0x4DEAFE8 by thread #2
==6703== Locks held: none
==6703==    at 0x12560A: std::__uniq_ptr_impl<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::_M_ptr() const (unique_ptr.h:173)
==6703==    by 0x1236A9: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::get() const (unique_ptr.h:422)
==6703==    by 0x121B8A: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::operator*() const (unique_ptr.h:408)
==6703==    by 0x121066: std::__future_base::_State_baseV2::wait() (future:337)
==6703==    by 0x12222D: std::__basic_future<void>::_M_get_result() const (future:719)
==6703==    by 0x12168C: std::future<void>::get() (future:891)
==6703==    by 0x11E30D: Tree::calculateTotalWeight() const (Tree.cpp:124)
==6703==    by 0x10FEDF: handleRequest(int) (Server.cpp:147)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #9
==6703== Locks held: none
==6703==    at 0x125806: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::__future_base::_Result_base*> >, std::is_move_constructible<std::__future_base::_Result_base*>, std::is_move_assignable<std::__future_base::_Result_base*> >::value, void>::type std::swap<std::__future_base::_Result_base*>(std::__future_base::_Result_base*&, std::__future_base::_Result_base*&) (move.h:205)
==6703==    by 0x123B42: std::__uniq_ptr_impl<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::swap(std::__uniq_ptr_impl<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>&) (unique_ptr.h:196)
==6703==    by 0x12201E: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::swap(std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>&) (unique_ptr.h:464)
==6703==    by 0x121573: std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) (future:576)
==6703==    by 0x1256AA: void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) (invoke.h:74)
==6703==    by 0x12375E: std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) (invoke.h:96)
==6703==    by 0x121C1F: std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const (mutex:776)
==6703==    by 0x12378E: std::once_flag::_Prepare_execution::_Prepare_execution<std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}>(void (std::__future_base::_State_baseV2::*&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*))::{lambda()#1}::operator()() const (mutex:712)
==6703==  Address 0x4deafe8 is 24 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during write of size 8 at 0x4DEAFE0 by thread #2
==6703== Locks held: none
==6703==    at 0x12B607: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::~_Task_state() (future:1454)
==6703==    by 0x12C013: void __gnu_cxx::new_allocator<int>::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (new_allocator.h:168)
==6703==    by 0x12BD60: void std::allocator_traits<std::allocator<int> >::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::allocator<int>&, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (alloc_traits.h:535)
==6703==    by 0x12B7BE: std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:528)
==6703==    by 0x11430E: std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (shared_ptr_base.h:168)
==6703==    by 0x113ACA: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (shared_ptr_base.h:705)
==6703==    by 0x1132DD: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (shared_ptr_base.h:1154)
==6703==    by 0x123BB9: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::reset() (shared_ptr_base.h:1272)
==6703==    by 0x1221EA: std::__basic_future<void>::_Reset::~_Reset() (future:755)
==6703==    by 0x121698: std::future<void>::get() (future:892)
==6703==    by 0x11E30D: Tree::calculateTotalWeight() const (Tree.cpp:124)
==6703==    by 0x10FEDF: handleRequest(int) (Server.cpp:147)
==6703== 
==6703== This conflicts with a previous read of size 8 by thread #9
==6703== Locks held: none
==6703==    at 0x122BE2: std::packaged_task<void ()>::operator()() (future:1604)
==6703==    by 0x11D7C9: LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}::operator()() const (Tree.cpp:35)
==6703==    by 0x1201F9: void std::__invoke_impl<void, LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}&>(std::__invoke_other, LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FB5D: std::enable_if<is_invocable_r_v<void, LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}&>, void>::type std::__invoke_r<void, LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}&>(LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F654: std::_Function_handler<void (), LeaderFollower::submitTask(std::function<void ()>)::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x11DA9C: LeaderFollower::workerThread() (Tree.cpp:58)
==6703==    by 0x12CAE1: void std::__invoke_impl<void, void (LeaderFollower::*)(), LeaderFollower*>(std::__invoke_memfun_deref, void (LeaderFollower::*&&)(), LeaderFollower*&&) (invoke.h:74)
==6703==  Address 0x4deafe0 is 16 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during read of size 8 at 0x4DEB000 by thread #2
==6703== Locks held: none
==6703==    at 0x122349: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::~unique_ptr() (unique_ptr.h:360)
==6703==    by 0x12B3CD: std::__future_base::_Task_state_base<void ()>::~_Task_state_base() (future:1427)
==6703==    by 0x12B625: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::~_Task_state() (future:1454)
==6703==    by 0x12C013: void __gnu_cxx::new_allocator<int>::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (new_allocator.h:168)
==6703==    by 0x12BD60: void std::allocator_traits<std::allocator<int> >::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::allocator<int>&, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (alloc_traits.h:535)
==6703==    by 0x12B7BE: std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:528)
==6703==    by 0x11430E: std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (shared_ptr_base.h:168)
==6703==    by 0x113ACA: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (shared_ptr_base.h:705)
==6703==    by 0x1132DD: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (shared_ptr_base.h:1154)
==6703==    by 0x123BB9: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::reset() (shared_ptr_base.h:1272)
==6703==    by 0x1221EA: std::__basic_future<void>::_Reset::~_Reset() (future:755)
==6703==    by 0x121698: std::future<void>::get() (future:892)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #9
==6703== Locks held: none
==6703==    at 0x122486: std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::__uniq_ptr_impl(std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:163)
==6703==    by 0x121728: std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>::__uniq_ptr_data(std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>&&) (unique_ptr.h:211)
==6703==    by 0x121752: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::unique_ptr(std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:327)
==6703==    by 0x12CB3A: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1419)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703==    by 0x12C3FF: std::enable_if<is_invocable_r_v<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>, std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> >::type std::__invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:116)
==6703==    by 0x12C0EA: std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void> >::_M_invoke(std::_Any_data const&) (std_function.h:291)
==6703==    by 0x122071: std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const (std_function.h:590)
==6703==  Address 0x4deb000 is 48 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during write of size 8 at 0x4DEB000 by thread #2
==6703== Locks held: none
==6703==    at 0x12237E: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::~unique_ptr() (unique_ptr.h:362)
==6703==    by 0x12B3CD: std::__future_base::_Task_state_base<void ()>::~_Task_state_base() (future:1427)
==6703==    by 0x12B625: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::~_Task_state() (future:1454)
==6703==    by 0x12C013: void __gnu_cxx::new_allocator<int>::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (new_allocator.h:168)
==6703==    by 0x12BD60: void std::allocator_traits<std::allocator<int> >::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::allocator<int>&, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (alloc_traits.h:535)
==6703==    by 0x12B7BE: std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:528)
==6703==    by 0x11430E: std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (shared_ptr_base.h:168)
==6703==    by 0x113ACA: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (shared_ptr_base.h:705)
==6703==    by 0x1132DD: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (shared_ptr_base.h:1154)
==6703==    by 0x123BB9: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::reset() (shared_ptr_base.h:1272)
==6703==    by 0x1221EA: std::__basic_future<void>::_Reset::~_Reset() (future:755)
==6703==    by 0x121698: std::future<void>::get() (future:892)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #9
==6703== Locks held: none
==6703==    at 0x122486: std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::__uniq_ptr_impl(std::__uniq_ptr_impl<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:163)
==6703==    by 0x121728: std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>::__uniq_ptr_data(std::__uniq_ptr_data<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter, true, true>&&) (unique_ptr.h:211)
==6703==    by 0x121752: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>::unique_ptr(std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>&&) (unique_ptr.h:327)
==6703==    by 0x12CB3A: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1419)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703==    by 0x12C3FF: std::enable_if<is_invocable_r_v<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>, std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> >::type std::__invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:116)
==6703==    by 0x12C0EA: std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void> >::_M_invoke(std::_Any_data const&) (std_function.h:291)
==6703==    by 0x122071: std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const (std_function.h:590)
==6703==  Address 0x4deb000 is 48 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during write of size 8 at 0x4DEAFE8 by thread #2
==6703== Locks held: none
==6703==    at 0x121B32: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::~unique_ptr() (unique_ptr.h:362)
==6703==    by 0x12B36B: std::__future_base::_State_baseV2::~_State_baseV2() (future:327)
==6703==    by 0x12B3D9: std::__future_base::_Task_state_base<void ()>::~_Task_state_base() (future:1427)
==6703==    by 0x12B625: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::~_Task_state() (future:1454)
==6703==    by 0x12C013: void __gnu_cxx::new_allocator<int>::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (new_allocator.h:168)
==6703==    by 0x12BD60: void std::allocator_traits<std::allocator<int> >::destroy<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >(std::allocator<int>&, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*) (alloc_traits.h:535)
==6703==    by 0x12B7BE: std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:528)
==6703==    by 0x11430E: std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (shared_ptr_base.h:168)
==6703==    by 0x113ACA: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (shared_ptr_base.h:705)
==6703==    by 0x1132DD: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (shared_ptr_base.h:1154)
==6703==    by 0x123BB9: std::__shared_ptr<std::__future_base::_State_baseV2, (__gnu_cxx::_Lock_policy)2>::reset() (shared_ptr_base.h:1272)
==6703==    by 0x1221EA: std::__basic_future<void>::_Reset::~_Reset() (future:755)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #9
==6703== Locks held: none
==6703==    at 0x125806: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::__future_base::_Result_base*> >, std::is_move_constructible<std::__future_base::_Result_base*>, std::is_move_assignable<std::__future_base::_Result_base*> >::value, void>::type std::swap<std::__future_base::_Result_base*>(std::__future_base::_Result_base*&, std::__future_base::_Result_base*&) (move.h:205)
==6703==    by 0x123B42: std::__uniq_ptr_impl<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::swap(std::__uniq_ptr_impl<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>&) (unique_ptr.h:196)
==6703==    by 0x12201E: std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>::swap(std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>&) (unique_ptr.h:464)
==6703==    by 0x121573: std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) (future:576)
==6703==    by 0x1256AA: void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) (invoke.h:74)
==6703==    by 0x12375E: std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) (invoke.h:96)
==6703==    by 0x121C1F: std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const (mutex:776)
==6703==    by 0x12378E: std::once_flag::_Prepare_execution::_Prepare_execution<std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}>(void (std::__future_base::_State_baseV2::*&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*))::{lambda()#1}::operator()() const (mutex:712)
==6703==  Address 0x4deafe8 is 24 bytes inside a block of size 88 alloc'd
==6703==    at 0x484B093: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x12B217: __gnu_cxx::new_allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >::allocate(unsigned long, void const*) (new_allocator.h:127)
==6703==    by 0x12B05A: std::allocator_traits<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >::allocate(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&, unsigned long) (alloc_traits.h:464)
==6703==    by 0x12ADD9: std::__allocated_ptr<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > > std::__allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> > >(std::allocator<std::_Sp_counted_ptr_inplace<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, (__gnu_cxx::_Lock_policy)2> >&) (allocated_ptr.h:98)
==6703==    by 0x12AC1F: std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>*&, std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:648)
==6703==    by 0x12AB95: std::__shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr_base.h:1342)
==6703==    by 0x12AAA2: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> >::shared_ptr<std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::_Sp_alloc_shared_tag<std::allocator<int> >, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:409)
==6703==    by 0x12A868: std::shared_ptr<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()> > std::allocate_shared<std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>, std::allocator<int>, std::function<void ()>, std::allocator<int> const&>(std::allocator<int> const&, std::function<void ()>&&, std::allocator<int> const&) (shared_ptr.h:863)
==6703==    by 0x1207B7: std::shared_ptr<std::__future_base::_Task_state_base<void ()> > std::__create_task_state<void (), std::function<void ()>, std::allocator<int> >(std::function<void ()>&&, std::allocator<int> const&) (future:1504)
==6703==    by 0x12A447: std::packaged_task<void ()>::packaged_task<std::function<void ()>, void>(std::function<void ()>&&) (future:1535)
==6703==    by 0x129F74: void __gnu_cxx::new_allocator<std::packaged_task<void ()> >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::packaged_task<void ()>*, std::function<void ()>&&) (new_allocator.h:162)
==6703==    by 0x129A75: void std::allocator_traits<std::allocator<std::packaged_task<void ()> > >::construct<std::packaged_task<void ()>, std::function<void ()> >(std::allocator<std::packaged_task<void ()> >&, std::packaged_task<void ()>*, std::function<void ()>&&) (alloc_traits.h:516)
==6703==  Block was alloc'd by thread #2
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703==  Lock at 0x59D5B60 was first observed
==6703==    at 0x4850CCF: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11119C: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==6703==    by 0x11169B: std::mutex::lock() (std_mutex.h:100)
==6703==    by 0x113AFB: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:229)
==6703==    by 0x11E0C1: Tree::calculateTotalWeight() const::{lambda()#1}::operator()() const (Tree.cpp:118)
==6703==    by 0x1202B3: void std::__invoke_impl<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FCBF: std::enable_if<is_invocable_r_v<void, Tree::calculateTotalWeight() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F748: std::_Function_handler<void (), Tree::calculateTotalWeight() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5b60 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateTotalWeight() const (Tree.cpp:105)
==6703== 
==6703== Possible data race during read of size 8 at 0x59D5AB8 by thread #2
==6703== Locks held: none
==6703==    at 0x11E33A: Tree::calculateTotalWeight() const (Tree.cpp:127)
==6703==    by 0x10FEDF: handleRequest(int) (Server.cpp:147)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==    by 0x12CB19: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1409)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #9
==6703== Locks held: 1, at address 0x59D5B60
==6703==    at 0x11E0DB: Tree::calculateTotalWeight() const::{lambda()#1}::operator()() const (Tree.cpp:119)
==6703==    by 0x1202B3: void std::__invoke_impl<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FCBF: std::enable_if<is_invocable_r_v<void, Tree::calculateTotalWeight() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F748: std::_Function_handler<void (), Tree::calculateTotalWeight() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5ab8 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateTotalWeight() const (Tree.cpp:105)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48515C6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D6E4: LeaderFollower::~LeaderFollower() (Tree.cpp:16)
==6703==    by 0x11E373: Tree::calculateTotalWeight() const (Tree.cpp:128)
==6703==    by 0x10FEDF: handleRequest(int) (Server.cpp:147)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48513D6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D8DA: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:40)
==6703==    by 0x11E643: Tree::calculateLongestDistance() const (Tree.cpp:138)
==6703==    by 0x10FEFA: handleRequest(int) (Server.cpp:148)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48515C6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D6E4: LeaderFollower::~LeaderFollower() (Tree.cpp:16)
==6703==    by 0x11E765: Tree::calculateLongestDistance() const (Tree.cpp:157)
==6703==    by 0x10FEFA: handleRequest(int) (Server.cpp:148)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48513D6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D8DA: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:40)
==6703==    by 0x11EA5F: Tree::calculateAverageDistance() const (Tree.cpp:168)
==6703==    by 0x10FF15: handleRequest(int) (Server.cpp:149)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ---Thread-Announcement------------------------------------------
==6703== 
==6703== Thread #16 was created
==6703==    at 0x4BE79F3: clone (clone.S:76)
==6703==    by 0x4BE88EE: __clone_internal (clone-internal.c:83)
==6703==    by 0x4B566D8: create_thread (pthread_create.c:295)
==6703==    by 0x4B571FF: pthread_create@@GLIBC_2.34 (pthread_create.c:828)
==6703==    by 0x4853767: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4952328: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x12742D: std::thread::thread<void (LeaderFollower::*)(), LeaderFollower*, void>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (std_thread.h:143)
==6703==    by 0x125F3A: void __gnu_cxx::new_allocator<std::thread>::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (new_allocator.h:162)
==6703==    by 0x12417B: void std::allocator_traits<std::allocator<std::thread> >::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::allocator<std::thread>&, std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (alloc_traits.h:516)
==6703==    by 0x124269: void std::vector<std::thread, std::allocator<std::thread> >::_M_realloc_insert<void (LeaderFollower::*)(), LeaderFollower*>(__gnu_cxx::__normal_iterator<std::thread*, std::vector<std::thread, std::allocator<std::thread> > >, void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:449)
==6703==    by 0x122891: std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (LeaderFollower::*)(), LeaderFollower*>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:121)
==6703==    by 0x11D61B: LeaderFollower::LeaderFollower(unsigned long) (Tree.cpp:7)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703==  Lock at 0x59D5B60 was first observed
==6703==    at 0x4850CCF: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11119C: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==6703==    by 0x11169B: std::mutex::lock() (std_mutex.h:100)
==6703==    by 0x113AFB: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:229)
==6703==    by 0x11E0C1: Tree::calculateTotalWeight() const::{lambda()#1}::operator()() const (Tree.cpp:118)
==6703==    by 0x1202B3: void std::__invoke_impl<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FCBF: std::enable_if<is_invocable_r_v<void, Tree::calculateTotalWeight() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F748: std::_Function_handler<void (), Tree::calculateTotalWeight() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5b60 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateAverageDistance() const (Tree.cpp:159)
==6703== 
==6703== Possible data race during read of size 4 at 0x59D5AB4 by thread #2
==6703== Locks held: none
==6703==    at 0x11EB54: Tree::calculateAverageDistance() const (Tree.cpp:185)
==6703==    by 0x10FF15: handleRequest(int) (Server.cpp:149)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==    by 0x12CB19: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1409)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703== 
==6703== This conflicts with a previous write of size 4 by thread #16
==6703== Locks held: 1, at address 0x59D5B60
==6703==    at 0x11E8DF: Tree::calculateAverageDistance() const::{lambda()#1}::operator()() const (Tree.cpp:177)
==6703==    by 0x12040B: void std::__invoke_impl<void, Tree::calculateAverageDistance() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateAverageDistance() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FF8C: std::enable_if<is_invocable_r_v<void, Tree::calculateAverageDistance() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateAverageDistance() const::{lambda()#1}&>(Tree::calculateAverageDistance() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F930: std::_Function_handler<void (), Tree::calculateAverageDistance() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5ab4 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateAverageDistance() const (Tree.cpp:159)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703==  Lock at 0x59D5B60 was first observed
==6703==    at 0x4850CCF: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11119C: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==6703==    by 0x11169B: std::mutex::lock() (std_mutex.h:100)
==6703==    by 0x113AFB: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:229)
==6703==    by 0x11E0C1: Tree::calculateTotalWeight() const::{lambda()#1}::operator()() const (Tree.cpp:118)
==6703==    by 0x1202B3: void std::__invoke_impl<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FCBF: std::enable_if<is_invocable_r_v<void, Tree::calculateTotalWeight() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F748: std::_Function_handler<void (), Tree::calculateTotalWeight() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5b60 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateAverageDistance() const (Tree.cpp:159)
==6703== 
==6703== Possible data race during read of size 8 at 0x59D5AB8 by thread #2
==6703== Locks held: none
==6703==    at 0x11EB5E: Tree::calculateAverageDistance() const (Tree.cpp:185)
==6703==    by 0x10FF15: handleRequest(int) (Server.cpp:149)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==    by 0x12CB19: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1409)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #16
==6703== Locks held: 1, at address 0x59D5B60
==6703==    at 0x11E8C4: Tree::calculateAverageDistance() const::{lambda()#1}::operator()() const (Tree.cpp:176)
==6703==    by 0x12040B: void std::__invoke_impl<void, Tree::calculateAverageDistance() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateAverageDistance() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FF8C: std::enable_if<is_invocable_r_v<void, Tree::calculateAverageDistance() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateAverageDistance() const::{lambda()#1}&>(Tree::calculateAverageDistance() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F930: std::_Function_handler<void (), Tree::calculateAverageDistance() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5ab8 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateAverageDistance() const (Tree.cpp:159)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48515C6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D6E4: LeaderFollower::~LeaderFollower() (Tree.cpp:16)
==6703==    by 0x11EBAB: Tree::calculateAverageDistance() const (Tree.cpp:186)
==6703==    by 0x10FF15: handleRequest(int) (Server.cpp:149)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48513D6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D8DA: LeaderFollower::submitTask(std::function<void ()>) (Tree.cpp:40)
==6703==    by 0x11EE83: Tree::calculateShortestDistance() const (Tree.cpp:196)
==6703==    by 0x10FF30: handleRequest(int) (Server.cpp:150)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ---Thread-Announcement------------------------------------------
==6703== 
==6703== Thread #18 was created
==6703==    at 0x4BE79F3: clone (clone.S:76)
==6703==    by 0x4BE88EE: __clone_internal (clone-internal.c:83)
==6703==    by 0x4B566D8: create_thread (pthread_create.c:295)
==6703==    by 0x4B571FF: pthread_create@@GLIBC_2.34 (pthread_create.c:828)
==6703==    by 0x4853767: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4952328: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x12742D: std::thread::thread<void (LeaderFollower::*)(), LeaderFollower*, void>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (std_thread.h:143)
==6703==    by 0x125F3A: void __gnu_cxx::new_allocator<std::thread>::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (new_allocator.h:162)
==6703==    by 0x12417B: void std::allocator_traits<std::allocator<std::thread> >::construct<std::thread, void (LeaderFollower::*)(), LeaderFollower*>(std::allocator<std::thread>&, std::thread*, void (LeaderFollower::*&&)(), LeaderFollower*&&) (alloc_traits.h:516)
==6703==    by 0x124269: void std::vector<std::thread, std::allocator<std::thread> >::_M_realloc_insert<void (LeaderFollower::*)(), LeaderFollower*>(__gnu_cxx::__normal_iterator<std::thread*, std::vector<std::thread, std::allocator<std::thread> > >, void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:449)
==6703==    by 0x122891: std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (LeaderFollower::*)(), LeaderFollower*>(void (LeaderFollower::*&&)(), LeaderFollower*&&) (vector.tcc:121)
==6703==    by 0x11D61B: LeaderFollower::LeaderFollower(unsigned long) (Tree.cpp:7)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703==  Lock at 0x59D5B60 was first observed
==6703==    at 0x4850CCF: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11119C: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==6703==    by 0x11169B: std::mutex::lock() (std_mutex.h:100)
==6703==    by 0x113AFB: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:229)
==6703==    by 0x11E0C1: Tree::calculateTotalWeight() const::{lambda()#1}::operator()() const (Tree.cpp:118)
==6703==    by 0x1202B3: void std::__invoke_impl<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x11FCBF: std::enable_if<is_invocable_r_v<void, Tree::calculateTotalWeight() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateTotalWeight() const::{lambda()#1}&>(Tree::calculateTotalWeight() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11F748: std::_Function_handler<void (), Tree::calculateTotalWeight() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5b60 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateShortestDistance() const (Tree.cpp:188)
==6703== 
==6703== Possible data race during read of size 8 at 0x59D5AB8 by thread #2
==6703== Locks held: none
==6703==    at 0x11EF78: Tree::calculateShortestDistance() const (Tree.cpp:214)
==6703==    by 0x10FF30: handleRequest(int) (Server.cpp:150)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==    by 0x12CB19: std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const (future:1409)
==6703==    by 0x12C8B8: std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) (invoke.h:61)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #18
==6703== Locks held: 1, at address 0x59D5B60
==6703==    at 0x11ED15: Tree::calculateShortestDistance() const::{lambda()#1}::operator()() const (Tree.cpp:205)
==6703==    by 0x1204B7: void std::__invoke_impl<void, Tree::calculateShortestDistance() const::{lambda()#1}&>(std::__invoke_other, Tree::calculateShortestDistance() const::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x1200ED: std::enable_if<is_invocable_r_v<void, Tree::calculateShortestDistance() const::{lambda()#1}&>, void>::type std::__invoke_r<void, Tree::calculateShortestDistance() const::{lambda()#1}&>(Tree::calculateShortestDistance() const::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x11FA24: std::_Function_handler<void (), Tree::calculateShortestDistance() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703==  Address 0x59d5ab8 is on thread #2's stack
==6703==  in frame #0, created by Tree::calculateShortestDistance() const (Tree.cpp:188)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==6703==    at 0x48515C6: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x11D6E4: LeaderFollower::~LeaderFollower() (Tree.cpp:16)
==6703==    by 0x11EFA5: Tree::calculateShortestDistance() const (Tree.cpp:215)
==6703==    by 0x10FF30: handleRequest(int) (Server.cpp:150)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==    by 0x12C04C: void std::__invoke_impl<void, std::function<void ()>&>(std::__invoke_other, std::function<void ()>&) (invoke.h:61)
==6703==    by 0x12BD87: std::enable_if<is_invocable_r_v<void, std::function<void ()>&>, void>::type std::__invoke_r<void, std::function<void ()>&>(std::function<void ()>&) (invoke.h:111)
==6703==    by 0x12B8E0: std::__future_base::_Task_state<std::function<void ()>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const (future:1468)
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during read of size 8 at 0x1540D8 by thread #1
==6703== Locks held: none
==6703==    at 0x49B2A22: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x49B2EBA: std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x10F221: signalHandler(int) (Server.cpp:42)
==6703==    by 0x4B0451F: ??? (in /usr/lib/x86_64-linux-gnu/libc.so.6)
==6703==    by 0x4BE945C: accept (accept.c:26)
==6703==    by 0x11098B: main (Server.cpp:246)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #2
==6703== Locks held: none
==6703==    at 0x49B2AE0: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x49B2EBA: std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x10F3DD: handleRequest(int) (Server.cpp:64)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==  Address 0x1540d8 is 24 bytes inside data symbol "_ZSt4cout@GLIBCXX_3.4"
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during write of size 1 at 0x4DE8CA3 by thread #1
==6703== Locks held: none
==6703==    at 0x4859796: mempcpy (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4B4D664: _IO_new_file_xsputn (fileops.c:1235)
==6703==    by 0x4B4D664: _IO_file_xsputn@@GLIBC_2.2.5 (fileops.c:1196)
==6703==    by 0x4B41FD6: fwrite (iofwrite.c:39)
==6703==    by 0x49B2B64: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x49B2EBA: std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x10F221: signalHandler(int) (Server.cpp:42)
==6703==    by 0x4B0451F: ??? (in /usr/lib/x86_64-linux-gnu/libc.so.6)
==6703==    by 0x4BE945C: accept (accept.c:26)
==6703==    by 0x11098B: main (Server.cpp:246)
==6703== 
==6703== This conflicts with a previous write of size 1 by thread #2
==6703== Locks held: none
==6703==    at 0x48597B4: mempcpy (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4B4D664: _IO_new_file_xsputn (fileops.c:1235)
==6703==    by 0x4B4D664: _IO_file_xsputn@@GLIBC_2.2.5 (fileops.c:1196)
==6703==    by 0x4B41FD6: fwrite (iofwrite.c:39)
==6703==    by 0x49B2B64: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x10F3F2: handleRequest(int) (Server.cpp:64)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==  Address 0x4de8ca3 is 35 bytes inside a block of size 1,024 alloc'd
==6703==    at 0x484A919: malloc (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==6703==    by 0x4B40BA3: _IO_file_doallocate (filedoalloc.c:101)
==6703==    by 0x4B4FCDF: _IO_doallocbuf (genops.c:347)
==6703==    by 0x4B4EF5F: _IO_file_overflow@@GLIBC_2.2.5 (fileops.c:744)
==6703==    by 0x4B4D6D4: _IO_new_file_xsputn (fileops.c:1243)
==6703==    by 0x4B4D6D4: _IO_file_xsputn@@GLIBC_2.2.5 (fileops.c:1196)
==6703==    by 0x4B41FD6: fwrite (iofwrite.c:39)
==6703==    by 0x49B2B64: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x49B2EBA: std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x11093D: main (Server.cpp:240)
==6703==  Block was alloc'd by thread #1
==6703== 
==6703== ----------------------------------------------------------------
==6703== 
==6703== Possible data race during write of size 8 at 0x1540D8 by thread #1
==6703== Locks held: none
==6703==    at 0x49B2AE0: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x49B2EBA: std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x10F221: signalHandler(int) (Server.cpp:42)
==6703==    by 0x4B0451F: ??? (in /usr/lib/x86_64-linux-gnu/libc.so.6)
==6703==    by 0x4BE945C: accept (accept.c:26)
==6703==    by 0x11098B: main (Server.cpp:246)
==6703== 
==6703== This conflicts with a previous write of size 8 by thread #2
==6703== Locks held: none
==6703==    at 0x49B2AE0: std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x49B2EBA: std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30)
==6703==    by 0x10F3DD: handleRequest(int) (Server.cpp:64)
==6703==    by 0x110644: main::{lambda()#1}::operator()() const (Server.cpp:256)
==6703==    by 0x110E03: void std::__invoke_impl<void, main::{lambda()#1}&>(std::__invoke_other, main::{lambda()#1}&) (invoke.h:61)
==6703==    by 0x110CE9: std::enable_if<is_invocable_r_v<void, main::{lambda()#1}&>, void>::type std::__invoke_r<void, main::{lambda()#1}&>(main::{lambda()#1}&) (invoke.h:111)
==6703==    by 0x110BD9: std::_Function_handler<void (), main::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==6703==    by 0x122DBD: std::function<void ()>::operator()() const (std_function.h:590)
==6703==  Address 0x1540d8 is 24 bytes inside data symbol "_ZSt4cout@GLIBCXX_3.4"
==6703== 
==6703== 
==6703== Use --history-level=approx or =none to gain increased speed, at
==6703== the cost of reduced accuracy of conflicting-access information
==6703== For lists of detected and suppressed errors, rerun with: -s
==6703== ERROR SUMMARY: 125 errors from 23 contexts (suppressed: 471 from 51)
